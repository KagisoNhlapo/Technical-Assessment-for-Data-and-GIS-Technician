---
title: "Creating maps"
author: "Kagiso"
date: "`r Sys.Date()`"
output: html_document
---
---
title: ""
output: html_notebook
---

## These are the maps of conservation of African

load the libraries

```{r}
library(tidyverse)
library(sf)
library(terra)
library(grid)
library(readxl)
library(rio)

```
Reading the data

```{r}

Bio_data <- import_list("C:/Users/NHLKAG001/Videos/Technical-Assessment-for-Data-and-GIS-Technician//Data/biodiversity_data.xlsx",
                                   setclass = "tbl", rbind = TRUE)

print(Bio_data)

```

```{r}

Country_level_data <- Bio_data %>%
  group_by(Country) %>%
  summarise(Diversity = n())

print(Country_level_data)
```

Read all the sheets names into a list of data frames

```{r}

barplot(Country_level_data$Diversity)

```
Now combine all sheets into one long data frame

```{r}

funding <- read.csv("C:/Users/NHLKAG001/Videos/Technical-Assessment-for-Data-and-GIS-Technician/Data/African_Conservation_Funding.csv")

print(funding)

```

### 2) Conduct exploratory analysis and provide some statistics and graphs

how the data looks per country (Plants and mammals)

```{r}

full_data <- left_join(Country_level_data, funding, by = "Country") %>% filter(!is.na(Funding..Million.USD.))

print(funding)

```

load the data

```{r}
afriSHP <- st_read("C:/Users/NHLKAG001/Videos/Technical-Assessment-for-Data-and-GIS-Technician/Data/african_countries_borders/african_countries_borders.shp")

print(afriSHP)

```

```{r}
RAST <- rast("C:/Users/NHLKAG001/Videos/Technical-Assessment-for-Data-and-GIS-Technician/Data/bii4africa_all.tif")

plot(RAST)
```

extract the biodiversity dat

```{r}

biodivRAST <- terra::extract(RAST, afriSHP)

print(biodivRAST)

```
```{r}

biodivRAST <- aggregate(bii4africa_all ~ ID, data = biodivRAST, mean)

print(biodivRAST)

```


join the Intactness Index, country and funding to the shapefile

```{r}

Mean_intactness<- aggregate(bii4africa_all ~ ID, data = biodivRAST, mean)

```

# creating map of Funding

```{r}
afriSHP$ID <- 1:59

afriSHP <- left_join(afriSHP,Mean_intactness, by = "ID")

```

# creating map of biodiversity

```{r}
afriSHP <- afriSHP %>% dplyr::select(ADM0_CODE,ADM0_NAME, 
                                     Shape_Leng, Shape_Area,
                                     bii4africa_all,geometry)
```

# creating map of intactness index

```{r}
full_data <- left_join(afriSHP, full_data, by = c("ADM0_NAME"="Country"))

print(full_data)
```

# plot all 3 maps ata high resolution 

```{r}
full_data <- full_data %>% dplyr::select(ADM0_NAME, Diversity, Funding..Million.USD., bii4africa_all, geometry)

print(full_data)
```
```{r}
full_data[is.na(full_data)] <- 0


ggplot() +
  geom_sf(data = full_data, aes(fill = Diversity, colour = Diversity)) +
  geom_sf_text(data = full_data, aes(label = ADM0_NAME), size = 2) +  # Adding region names
  theme(panel.background = element_rect(fill = "white")) +
  coord_sf() +  # Ensures map uses coordinate system
  labs(x = "Longitude", y = "Latitude")

```





